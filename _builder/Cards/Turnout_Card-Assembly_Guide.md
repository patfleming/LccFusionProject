---
title: Turnout Card Assembly Guide
typora-root-url: ../..
layout: default
permalink: /:name/
parent: Card Assembly Guides
nav_order: 2
use_cases:
  - PCB Design & Assembly
  - Node Cluster Setup
  - Device Control
  - Signaling Systems
  - Automation Deployment
terms:
  # LCC Fusion Project Terms
  - lcc_fusion_cards
  - lcc_fusion_project
  - lcc_fusion_node_bus
  - lcc_fusion_breakout_boards

  # LCC Fusion Connect Terms
  - lcc_fusion_node_card
  - lcc_fusion_io_cards
  - output_cards
  - hw_communications_address
  - hw_communications_bus

  # NMRA LCC Network Terms
  - lcc_event_monitoring_tool
  - lcc_configuration_tool
  - lcc_event_id

  # Model Railroad Automation Terms
  - accessory_bus

  # Hardware and firmware Terms
  - bus
  - cleaning_pcb
  - component
  - current_limiting_resistor
  - decoupling_capacitor
  - edge_card_connector
  - esd_protection_diode
  - ferrite_bead
  - gpio_expander
  - jumper_caps
  - i2c
  - i2c_bus
  - mcp23017
  - network_cable
  - stencil
  - tvs_diode
---
# Turnout Card Assembly Guide {#turnout_card_assembly}
{: .no_toc }
{:toc}
<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>
## Introduction

In conjunction with the **LCC Fusion** LCC Fusion Node Card and a Node Bus Hub, the **Turnout Card** provides control of up to 8 turnouts motors and points sets positions.. Typically, in an LCC Node arrangement, a this card responds to LCC events generated by input buttons, sensors, or LCC Logics & Conditional statements.

 The Turnout Card uses a network cable to connect to one of following breakout boards to control the turnouts.

{% include terminology.html %}

## Specifications

Specifications for the card include:

| Characteristic                                               | Value               |
| ------------------------------------------------------------ | ------------------- |
| Output                                                       | 9V, 12V<sup>1</sup> |
| Max Output Lines                                             | 16                  |
| Max Output Line (based on M54562FP IC)                       | 500mA               |
| Max Total Output (using Line 16)                             | 16                  |
| Maximum Number of Cards per LCC Fusion Node Cluster | 16<sup>2</sup>      |
| LCC Fusion Node Bus HubConnectors     | 1<sup>3</sup>       |

1. Output voltage to turnout motors is selectable.  Suggest using 9V for stall motor switch machines (TORTOISE™ DCCconcepts) to reduce speed and noise. 
2. The LCC Fusion Node Cluster can support up to 16 cards, distributed across two I2C hardware buses, with a maximum of 8 cards per bus.
   - Note: total includes all cards using the I2C address range of ````0x20```` (MCP23017 IC).
3. GND, 5V, 12V (optional), SLA0/SDA0, and SDA1/SCL1 (optional)

The description you've provided for the **turnout card** looks clear and detailed. Here's how it works based on the information given:

---

### **How It Works**

The **Turnout Card** is designed to interface with various turnout breakout boards, providing control over turnout motors and sensing the turnout’s position (thrown or closed). The following steps outline how the system operates:

1. **Control of Turnout Motor Direction**:
   - The **`COMM BUS`** and **`COMM ADDR`** switches must be set to match the **LCC CDI configuration** for the **Turnout Card**.
   - This allows the card to:
     - **Receive turnout motor direction control requests** from the **LCC Fusion Node Card** via the **MCP23017 GPIO** (configured using I2C commands).
     - The card utilizes a **TC4428 IC** to send a bidirectional current to the turnout motor through **RJ45 pins 1/2 (motor 1)** and **pins 5/6 (motor 2)**. The current direction controls the movement of the turnout.
     - The current remains **continuous** until a request is received to change the direction.
     - The **`OUTPUT`** selection provides options for either **9V** or **12V** to the breakout boards. Using **9V** may result in quieter and slower operation for stall motor switch machines.

2. **Turnout Point Status Reporting**:
   - The turnout card uses **sense lines** connected via the **RJ45 pins 3/4 and 7/8** as inputs to the **74HCT00 IC (Dual NAND)**.
   - The **74HCT00** processes the sense lines and sets a corresponding **MCP23017 GPIO** to either **HIGH** or **LOW**, indicating the turnout's point status (closed or thrown).
   
   #### Logic Table for Sense Lines:

   | **Sense Line 1** | **Sense Line 2** | **Output (GPIO)** | **Description**                      |
   | ---------------- | ---------------- | ----------------- | ------------------------------------ |
   | Low (GND)        | High (3.3V)      | High              | Turnout points are **closed**        |
   | High (3.3V)      | Low (GND)        | Low               | Turnout points are **thrown**        |
   | High (3.3V)      | High (3.3V)      | No change         | **Points moving** (holds last state) |

### Connections

Components Designator  **Connector Label**  Connector  Type  **Connection Number**  **Function**  **Description**

| Component Designator | Connector Label | Connector Type           | Connection Number | **Function**                        | **Description**                                              |
| -------------------- | --------------- | ------------------------ | ----------------- | ----------------------------------- | ------------------------------------------------------------ |
|                      | **NODE BUS**    | Card Edge                | 1-12              | Power, Communications               | Connection to Node Bus Hub                                   |
| **JP1, JP2**         | **COMM BUS**    | 3-Pin Male Header        | 1 - 3             | Communication Bus Selection         | Use 2 Jumper Caps to select the communications bus to use, `A` or `B`.  Must use the selection for both JP1 and JP2<br>**NOTE:** Must match card’s CDI configuration settings. |
| **JP3**              | **OUTPUT**      | 3-Pin Male Header        | 1 - 3             | Power selection                     | Use Jumper Cap to select the card’s output power to either `9V` or `12V` |
| **SW1**              | **COMM ADDR**   | Slide Switch, 3 Position | 1 - 3             | Communications Address selection    | Slide switches to `ON` to set communications address.  <br>Examples: all `OFF` for 0, all `ON` for 7.<br> **NOTE:** Must match card’s CDI configuration settings. |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 1             | Motor 1: Thrown Control             | Sends a pulse to throw the turnout (move to **Thrown**). The frog is connected to **Rail A** when this pin is activated. |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 2             | Motor 1: Closed Control             | Sends a pulse to close the turnout (move to **Closed**). The frog is connected to **Rail B** when this pin is activated. |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 3<sup>1</sup> | Motor 1: Sense Pin (Turnout Status) | Returns the turnout point status for Twin-Coil Machine 1 (LOW for **Thrown**) |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 4<sup>1</sup> | Motor 1: Sense Pin (Turnout Status) | Returns the turnout point status for Twin-Coil Machine 1 (LOW for **Closed**) |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 5             | Motor 2: Thrown Control             | Sends a pulse to throw the turnout (move to **Thrown**). The frog is connected to **Rail A** when this pin is activated. |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 6             | Motor 2: Closed Control             | Sends a pulse to close the turnout (move to **Closed**). The frog is connected to **Rail B** when this pin is activated. |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 7<sup>1</sup> | Motor 2: Sense Pin (Turnout Status) | Returns the turnout point status for Twin-Coil Machine 2 (LOW for **Thrown**) |
| **J1, J2, J3, J4**   | **TURNOUTS**    | RJ45 Socket              | Pin 8<sup>1</sup> | Motor 2: Sense Pin (Turnout Status) | Returns the turnout point status for Twin-Coil Machine 2 (LOW for **Closed**) |

1. RJ45 Pins 3 and 4 default to HIGH via pullup resistors on the Turnout Card.  Relays set sense pins to GND when motor controls trigger switch machine to move the turnout points.

### Protection

The **Turnout Card** is equipped with several protective components to ensure reliable operation and safeguard the board and connected devices from potential electrical issues. Below is an overview of the protection mechanisms implemented:

| **Protected Component**     | **Protection Component**            | **Function**                                                 | **Specifications**              | **Location**                                    |
| --------------------------- | ----------------------------------- | ------------------------------------------------------------ | ------------------------------- | ----------------------------------------------- |
| **I2C Communication Lines** | **PESD1CAN Diode**                  | Protects the I2C lines from **ESD (Electrostatic Discharge)** and other electrical surges. | **Clamping voltage**: 24V max   | Located on I2C data (SDA, SCL) lines.           |
| **I2C Communication Lines** | **FB121S Diodes**                   | Provides additional protection to the I2C lines by filtering out high-frequency noise and protecting against voltage spikes. | **Bidirectional TVS diode**     | Positioned along I2C communication lines.       |
| **I/O Control Lines**       | **10kΩ Current Limiting Resistors** | Limits the current on the **motor control** and **point sensing lines**, protecting the MCP23017 and associated circuitry. | 10kΩ resistors to limit current | On the motor control and point sensing lines.   |
| **I2C Address Selector**    | **10kΩ Current Limiting Resistors** | Limits the current on the I2C address configuration pins, preventing excessive current from damaging the MCP23017. | 10kΩ resistors                  | On the I2C address offset selector switches.    |
| **MCP23017 Port Expander**  | **0.1µF Decoupling Capacitor**      | Reduces noise and stabilizes the power supply to the MCP23017, ensuring smooth operation. | **Capacitance**: 0.1µF          | Positioned near the MCP23017 power supply pins. |
| **L7809 Regulator**         | **Output Capacitor**                | Filters out high-frequency noise and transient voltage spikes from the output, ensuring stable 12V regulation. | **Value:** 10 µF ceramic        | Across the output (12V) and GND                 |



 ## Components List

PCB for the card can be ordered from any PCB fabricator using these [Gerber Files]({{site.gerber_dir}}Turnout Card.zip).

[PCB Components](/pcb-parts/) - listing of items used for PCB assembly

[PCB Components](/pcb-components/) - listing of components used for PCB assembly

The design of the Output Card includes provisions for integrating current-limiting resistors and an optional bypass feature.  These resistors do not have to be 10k&Omega; as shown on the PCB.  Instead, match the resistor to the needs of the devices.  For LEDs, see  [Choosing the Right Resistor for LEDs](/led-card-usage-guide/) for additional information.

Below is a list of the PCB components used for this card (see diagram on right for reference): 

| Component Identifier | Count | Type               | Value/Description                    | Package    | Required?                        | Purpose                                                      |
| -------------------- | ----- | ------------------ | ------------------------------------ | ---------- | -------------------------------- | ------------------------------------------------------------ |
| C1 - C4              | 4     | Capacitor          | 0.1uF                                | 1206 SMD   | Required                         | Decoupling Capacitor for IC Protection                       |
| C5                   | 1     | Capacitor          | 1uF                                  | 1206 SMD   | Required when using 9V regulator | Smoothing Capacitor for output from L7809 regulator          |
| C6                   | 1     | Tantalum Capacitor | 0.33uF                               | 3216 SMD   | Required when using 9V regulator | Filter Capacitor for L7809 regulator input                   |
| D1                   | 1     | Diode              | PESD1CAN                             | SOT-23 SMD | Required                         | I2C data bus electrostatic discharge (ESD) protection        |
| FB1, FB2             | 2     | Ferrite Bead       | BLM31PG121SN1L                       | 1206 SMD   | Required                         | I2C Network Bus Data Line Noise Suppression Ferrite Bead     |
| J1 - J4              | 4     | RJ45 Socket        | 8P8C                                 | PTH        | Required                         | Network cable (CAT5/6) connection to a turnout breakout board |
| JP1, JP2             | 2     | Male Header        | 3-Pin (0.1" spacing)                 | PTH        | Required                         | Used for COMM BUS selection (I2C hardware bus) for either BUS A or BUS B. |
| JP3                  | 1     | Male Header        | 3-Pin (0.1" spacing)                 | PTH        | Required                         | Used to select 9V or 12V output for motors. Set to 12V position when not using 9V |
| R1 - R16             | 16    | Resistor           | 10kΩ                                 | 1206 SMD   | Required                         | Limits the current between this card and the breakout board to protect the IC |
| R17 - R20            | 4     | Resistor           | 10kΩ                                 | 1206 SMD   | Required                         | Limits the current to SW1 and MCP23017 for the I2C address   |
| SW1                  | 1     | DIP / Slide Switch | 3-Pin (2.54mm spacing)               | PTH        | Required                         | Used for COMM ADDR selection (I2C address offset, 0-7).      |
| U1 - U4              | 4     | IC                 | 74HCT00 Dual NAND Gate               | SOP-20 SMD | Required                         | Monitors turnout breakout board’s point position lines. Sets MCP23017 GPIO pins HIGH or LOW based on state. |
| U5 - U12             | 8     | IC                 | TC4428 Bi-directional MOSFET Driver  | SOP-8 SMD  | Required                         | Provides 12V to turnout breakout board, controlling motor direction based on MCP23017 GPIO pin state. |
| U13                  | 1     | IC                 | MCP23017 I/O Expander (16 GPIO pins) | SOP-14 SMD | Required                         | I/O Expander using I2C serial interface to control 16 GPIO pins |
| VR3                  | 1     | Voltage Regulator  | L7809CTCV                            | TO-220     | Required when using 9V regulator | Provides 9V for stall motor switch machines to reduce speed and noise |

## Tools Required

> [List of recommended tools](/pcb-tools/).

## Safety Precautions

- See [Safety Precautions](/safety-precautions/). 

## Assembly Instructions

<img src="/assets/images/pcbs/Turnout_Card/Turnout_Card_pcb.png" style="zoom:50%; float:right" />Below are the high level steps for assembly of the Turnout Card:

1. Clean PCB with alcohol to remove residue.  See [Cleaning_PCB](/pcb-prep/) for details.
2. When using a PCB stencil to apply the paste, align the stencil over the PCB using the 2 Tooling Holes located at the top and bottom of the card.  There are very small holes with no labels or markings.  Use a thick straight pin or wire for the alignment, pushing down into a soft foam surface to hold the pin/wire in place.
3. Apply soldering paste for all SMD components
4. Place SMD components into paste.  

> See also: [Soldering Tips](/pcb-soldering/)

| Component Identifier | Component (Package)                  | Required?                        | Orientation                                                  |
| -------------------- | ------------------------------------ | :------------------------------- | ------------------------------------------------------------ |
| C1 - C4              | 0.1uF Capacitor (1206 SMD)           | Required                         | None                                                         |
| C5                   | 1uF Capacitor (1206 SMD)             | Required when using 9V regulator | None                                                         |
| C6                   | 0.33uF Tantalum Capacitor (3216 SMD) | Required when using 9V regulator | Cathode end has a brown line and positioned towards PCB left edge |
| D1                   | Diode, PESD1CAN, SOT-23 SMD          | Required                         | Fits only one way                                            |
| FB1, FB2             | Diode, BLM31PG121SN1L, 1206 SMD      | Required                         | None                                                         |
| J1, J2, J3, J4       | RJ45 socket (8P8C)                   | Required                         | Fits only one way                                            |
| JP1, JP2, JP3        | Male headers (3P, 0.1" spacing)      | Required                         | None                                                         |
| R1-R20               | 10kΩ resistors (1206 SMD)            | Required                         | None                                                         |
| SW1                  | DIP / Slide Switch (3P, 2.54mm)      | Required                         | Position so switch so **ON** is towards PCB left edge        |
| U1 - U4              | 74HCT00 IC (SOP20 SMD)               | Required                         | IC dimple (pin 1) is positioned towards PCB top edge         |
| U5 - U12             | TC4428 (SOP-8 SMD)                   | Required                         | IC dimple (pin 1) is positioned towards PCB bottom edge      |
| U13                  | MCP23017 IC (SSOP28)                 | Required                         | IC indent (pin 1) is positioned towards PCB top edge         |
| VR3                  | L7809CTCV Voltage Regulator (TO-220) | Required when using 9V regulator | Position heatsink towards PCB left edge                      |

## Testing and Verification

Configure the card:

1. Select the I2C bus (**COMM BUS**) by positioning (2) Jumper Caps on either BUS A or BUS B male header pins (JP1, JP2)
2. Select the I2C address **(COMM ADDR)** switch (SW1) by slide each of the 3 switches to either the ON or OFF position.  Setting a switch to ON increments the address by 1, 2, or 4 for an address range of 0 to 7.  Up to 8 devices can then be configured for BUS A and 8 for BUS B.
3. Select the motor output voltage (9V or 12V).

The following test and verifications of the card should be performed after a through inspection of the card's soldering.  Check all of the PTH component pins and SMD pads.  Make sure there are no solder bridges between pins and pads.

### Visual Inspection

1. **Initial Check**: Examine the board for any obvious issues like missing components, solder bridges, or components that are misaligned or not fully seated.

2. **Solder Joint Inspection**: Use a magnifying glass or a microscope to inspect solder joints. Look for cold solder joints, insufficient or excessive solder, or any shorts between pads.

3. **Component Orientation**: the IC's are correctly oriented according to the PCB silkscreen or schematic.

### Connectivity Testing

1. **Continuity Check**: Use a multimeter in continuity mode to check for shorts between power rails and ground, and to ensure there are no open circuits in critical connections.

### Power-Up Tests

1. Assembly a tested Power Module to the LCC Fusion Node Card.
2. Apply Power to the Power Module and verify the following:
   - **Check for Hot Components**: Feel for components that are overheating, which could indicate a problem like a short circuit or incorrect component.

### Functional Testing

#### I2C Verification

1. Verify that the I2C connection between the  LCC Fusion Node Card and the Output Card work.  See [Testing I2C Cards](@ref testing_I2C_cards) for details on how to test the I2C for a I2C enabled card.

#### Turnout Verification

After validating the LCC Fusion Node Card can connect with the Turnout Card, test each of the output lines as follows:
1. Connect an network cable (CAT5/6) to RJ45 connector.  Use the other end of the cable with one of the turnout breakout boards, or exposed wires to connect to a turnout switch for testing.
2. Configure the card using an LCC CDI Configuration Tool
  6. Test using LCC events:

        1. Send the configured on/off LCC Event ID's for each turnout motor

        2. Validate that motor movements

## Troubleshooting

- See [I2C Trouble Shooting](/test-i2c-cards/).

## Firmware Implementation Notes

The following outlines the key steps for implementing firmware to interact with the **Turnout Card**:

1. **Connect I2C** 

   - Use the I2C bus and address as configured on the card. The card’s **COMM ADDR** is an offset added to the I2C base address of **0x20**. For example, if the **COMM ADDR** is set to **2** (switches set to **010**), the firmware must communicate with the I2C device at address **0x22** (0x20 + 2).

2. **Configure GPIO Ax (A0-A7) for Motor Direction Control**:

   - Configure **A0-A7** pins on the **MCP23017** as **OUTPUT**.
   - Set the GPIO pins to **HIGH** or **LOW** to control motor direction. Depending on the configuration, a **HIGH** or **LOW** signal will move the motor in one direction or the other.

3. **Configure GPIO B0-B7 for Point Status Reading**:

   - Configure **B0-B7** pins on the **MCP23017** as **INPUT**.
   - Read the GPIO pin state to determine the turnout point status as either **Thrown** or **Closed**. The **HIGH** or **LOW** state of the pin will indicate the turnout’s position, but note that which state corresponds to **Thrown** or **Closed** depends on the configuration.

   > Note: The card’s internal IC prevents GPIO floating, so no external pull-up resistor is required.

## References

- Turnout Motor list: [https://dccwiki.com/Turnout_Motors](https://dccwiki.com/Turnout_Motors)

