---
title: <name> Card Assembly Guide
typora-root-url: ../..
layout: default
permalink: /:name/
parent: Card Assembly Guides
nav_order: 2
use_cases:
  - PCB Design & Assembly
  - Node Cluster Setup
  - Signaling Systems
  - Train Detection
  - Device Control
  - LCC Event Management
  - Automation Deployment
  - System Configuration
  - Learning & Planning
  - Hardware Testing & Maintenance

subjects:
  - Hardware
  - Software
  - Networking
  - Automation
  - Signaling
  - Train Detection
  - Event Management
  - Testing & Debugging
  - Learning Resources
  - Project Planning
  - Device Control
  - Configuration Guides

terms:
  # LCC Fusion Project Terms
  - lcc_fusion_cards
  - lcc_fusion_project
  - lcc_fusion_node_bus
  - lcc_fusion_node_cluster
  - lcc_fusion_breakout_boards
  - lcc_fusion_virtual_node_cluster

  # LCC Fusion Connect Terms
  - lcc_fusion_node_card
  - lcc_fusion_io_cards
  - output_cards
  - hw_communications_address
  - hw_communications_bus

  # NMRA LCC Network Terms
  - lcc_event_monitoring_tool
  - lcc_configuration_tool
  - lcc_event_id

  # Model Railroad Automation Terms
  - track_bus
  - accessory_bus

  # Hardware and Software Terms
  - adapter
  - amplifier
  - audio_signal
  - bridge_rectifier
  - bus
  - dcc_signal
  - canable
  - can_network
  - can_termination
  - charging_circuit
  - cleaning_pcb
  - component
  - current_limiting_resistor
  - decoupling_capacitor
  - edge_card_connector
  - esd_protection_diode
  - esp32_s3
  - ferrite_bead
  - gpio_expander
  - jumper_caps
  - i2c
  - i2c_bus
  - i2s
  - li_po_battery
  - low_voltage_detection
  - mcp23017
  - network_cable
  - optocoupler
  - polyfuse
  - pull_up_resistor
  - pwm
  - shield
  - stencil
  - tvs_diode

  # Troubleshooting and Support Terms
published: False
---
# <name> Card Assembly Guide {#<name>_card_assembly}
{: .no_toc }
{:toc}
<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>
## Introduction

In conjunction with the **LCC Fusion** [Node Card](/node-card-assembly-guide/) and a [Node Bus Hub](/node-bus-hub-assembly-guide/), the **[Audio Card](/audio-card-assembly-guide/)** provides text-to-audio functionality through up to four speakers. Administrators can use an LCC Configuration Tool to specify text messages to be played based on specific LCC Event IDs. The [Audio Card](/audio-card-assembly-guide/) receives these text messages from one or more LCC Nodes, converts the text to audio, and then, using a low-powered audio amplifier, plays the audio to one of the four speakers.

Possible uses of the [Audio Card](/audio-card-assembly-guide/) include, but are not limited to, providing audio feedback of messages to LCC users. Audio can be generated from messages such as:

- Key error and status messages
- User-defined messages based on LCC Event IDs (configured via the CDI)

The **[Audio Card](/audio-card-assembly-guide/)** hardware configuration includes:

- **SuperMini ESP32-S3 module:** This module provides the firmware to process the text-to-audio conversion as follows:
  - Receives text messages via I2C or Bluetooth
  - Converts the text to audio signals using the Espeak-NG Text-to-Speech Library
  - Sends the audio signals via I2S to the audio amplifier
- **Audio Amp:** Up to 4x MAX98357A IC audio amplifiers, each sending audio to a speaker via connections (RJ45 or 2-pin terminal connector).

{% include terminology.html %}

## Specifications

Specifications for the card include:

| Characteristic                           | Value          |
| ---------------------------------------- | -------------- |
| Max Speakers                             | 4              |
| Max Audio Amps                           | 4              |
| Max Text Message Length                  | 16K Chars      |
| Maximum Number of Cards per Node Cluster | 16<sup>1</sup> |
| Node Bus Connectors                      | 1<sup>2</sup>  |

1. The Node cluster can support up to 16 cards, distributed across two I2C hardware buses, with a maximum of 8 cards per bus.
   - Note: This total includes all cards using the I2C address range of `0x60` (defined by ESP32 firmware for audio).
2. Connections: GND, 5V, SCL0/SDA0, and SDA1/SCL1

### How It Works

The following outlines the flow of activity for the [Audio Card](/audio-card-assembly-guide/):

The firmware of the [Node Card](/node-card-assembly-guide/) interfaces with the [Audio Card](/audio-card-assembly-guide/)'s ESP32, leveraging the bus and address details specified in the card's CDI I2C section.

Text-to-audio conversion is performed as follows:

1. Upon receiving an LCC Event-related signal, the [Node Card](/node-card-assembly-guide/)'s firmware dispatches an I2C text message to the [Audio Card](/audio-card-assembly-guide/), instructing it to convert the text to audio for the configured audio device.
2. Alternatively, the [Audio Card](/audio-card-assembly-guide/) can receive text messages via Bluetooth from a Bluetooth Serial App (such as on a phone).
3. The [Audio Card](/audio-card-assembly-guide/)’s ESP32 uses a text-to-speech library to convert the text to audio signals and passes them to the audio amplifier using an I2S (serial) connection.
4. The audio amplifier outputs the audio signal to its speaker attached to either a JST XH socket or an RJ45 socket.

### Protection

The [Audio Card](/audio-card-assembly-guide/) provides text message to audio conversion that are amplified and outputted thru speakers. Below is an overview of each protection component integrated into the [Audio Card](/audio-card-assembly-guide/) and its role:

| Protected Component    | Protection Component              | Function                                                     | Specifications                                               | Location                                            |
| ---------------------- | --------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------- |
| **Speaker Connectors** | **SS310 Diodes**                  | Protect against reverse voltage by blocking current flow in the wrong direction. | **Reverse Voltage:** 100V<br>**Forward Current:** 3A         | In series with each input/output power connector    |
| **Audio Amp**          | **Decoupling Capacitors**         | Filters out high-frequency noise and transient voltage spikes from the power supply, ensuring stable voltage to audio amp IC. | **Values:** 0.1 µF ceramic, 10 µF electrolytic or ceramic    | Across Vcc and GND near IC.                         |
| **I2C Lines**          | **Ferrite Bead BLM31PG121SN1L**   | Provides high-frequency noise suppression on the I2C lines.  | **Impedance:** 120 ohms at 100 MHz                           | In series with the SDA and SCL lines of the I2C bus |
| **I2C Lines**          | **ESD Protection Diode PESD1CAN** | Protects the I2C lines from electrostatic discharge and voltage spikes. | **Reverse Stand-off Voltage (Vr):** 24V<br>**Clamping Voltage (Vc):** 40V | Across the SDA and SCL lines to GND                 |
| **Speaker Connectors** | **SS310 Diodes**                  | Protect against reverse voltage by blocking current flow in the wrong direction. | **Reverse Voltage:** 100V<br>**Forward Current:** 3A         | In series with each speaker connectors              |

## Components List

PCB for the card can be ordered from any PCB fabricator using these [Gerber Files]({{site.gerber_dir}}[Audio Card](/audio-card-assembly-guide/).zip).

[PCB Parts](/pcb-parts/) - listing of items used for PCB assembly

[PCB Components](/pcb-components/) - listing of components used for PCB assembly

Below is a list of the PCB components used for this card (see diagram on right for reference):

| Component Identifier | Component (Package)                                          | Required?                                             | Purpose                                                      |                                                       |
| --------------- | ------------------------------------------------------------ | :----------------------------------------------------------- | ------------------------------------------------------------ | --------------- |
|  | PCB /w Solder Stencil | Required | PCB for the [Node Card](/node-card-assembly-guide/) can be ordered from any PCB fabricator using these [Gerber Files]({{site.gerber_dir}}[Audio Card](/audio-card-assembly-guide/).zip). |  |
| C1, C3, C5, C7, C10 | 0.1uF Capacitor (1206 SMD)                                  | Required               | Decoupling Capacitor for IC Protection                       |                        |
| C2, C4, C6, C8, C9 | 10uF Capacitor (1206 SMD) | Required | Decoupling Capacitor for IC Protection |  |
| D1 - D8 | Diode, SS310 (SMD) | Required | Circuit protection from reverse current from speaker connections. | 0.20 |
| FB1, FB2 | Diode, BLM31PG121SN1L, 1206 SMD | Required | I2C Network Bus Data Line Noise Suppression Ferrite Bead | 0.10 |
| D5 | Diode, PESD1CAN, SOT-23 SMD | Optional | I2C data bus electrostatic discharge (ESD) |  |
| J1-J4 | JST XH Socket (2P, 2.54mm), or<br>2-Position Spring Terminal Connector (2.54mm) | Optional  | Connectors to speakers                                       | 0.40 |
| J5 | RJ45 socket (8P8C)                                           | Optional | Network cable (CAT5/6) connections to speakers (4 pairs). |  |
| J6, J7 | 9-Pin Female Headers | Required | Socket for Super-Mini ESP32-S3 development board(s) | 0 |
| JP1, JP2 | 3-Pin Male Headers (3P, 0.1" spacing) | Required | Used for COMM BUS selection (I2C hardware bus) for either BUS A or BUS B.  These are the ESP32 hardware buses used for serial communications (0 or 1).  **Note,** that setting of this switch must match the configuration for this card within the LCC Node configuration (CDI). |  |
| R1, R2, R3 | 10k&Omega; resistors (1206 SMD) | Required | Used to limit the current to SW1 and MCP23017 for the I2C address | |
| SW1 | DIP / Slide Switch (3P, 2.54mm) | Required | Used for COMM ADDR selection (I2C address offset, 0-7).  This offset is added to the I2C base address of the MCP23017 IC (0x20).  Up to 8 [Audio Card](/audio-card-assembly-guide/)s can be installed per I2C bus for a total of 16 cards. <br>**Note,** that setting of this switch must match the configuration for this card within the LCC Node configuration (CDI). | |
| U1, U2, U3, U4 | Audio Amp, MAX98357A IC, TQFN | Required | Class D audio amplifer supporting I2S connections | 0.50 |

## Tools Required

> [List of recommended tools](/pcb-tools/).

## Safety Precautions

- See [Safety Precautions](/safety-precautions/). 

## Assembly Instructions

 <img src="/assets/images/pcbs/Audio_Card/Audio_Card_pcb.png" style="zoom:50%; float:right" />Below are the high level steps for assembly of the [Audio Card](/audio-card-assembly-guide/):

1. Determine component orientation:
   - Male headers, DIP switches, resistors, and (ceramic) capacitor components are not polarized and can be installed in either direction.
   - Position the IC's using their dimple in the corner to align in the direction of the silkscreen end with a dimple  (refer to  [Soldering Tips](@ref soldering_tips)).

2. Clean PCB with alcohol to remove residue.  See [Cleaning_PCB](/pcb-prep/) for details.

3. When using a PCB stencil to apply the paste, align the stencil over the PCB using the 2 Tooling Holes located at the top and bottom of the card.  There are very small holes with no labels or markings.  Use a thick straight pin or wire for the alignment, pushing down into a soft foam surface to hold the pin/wire in place.

4. Apply soldering paste for all SMD components: 

   1. Capacitors: no specific orientation required (C1 - C10)

   2. Diodes SS310: note orientation, cathode (vertical line) faces left (D1 - D8)

   3. Diodes PESD1CAN with no orientation required  (D9, D10)

   4. Ferrite Beads: BLM31 with no orientation required (FB1 - FB4)

   5. Audio Amps: MAX39357A IC orientation required with small dot (pin 1) positioned in lower left corner (U1 - U4)

      > Note that one or more audio amps can be installed.  Each audio amp configuration consists of MAX39357A IC, 2 capacitors (0.1 uF, 10uF), 2 diodes (SS310), and speaker connections (JST XH and/or RJ45 socket).

5. Reflow the solder for the SMD component (refer to  [Soldering Tips](/pcb-soldering/)).

6. Place PTH components
   1. Solder (2) 9-Pin Female Headers (J6, J7)
   2. Solder (2) 3-Pin Male Headers (JP1, JP2)
   3. Solder DIP / Slide Switch (SW1)
   4. For speaker connections:
      1. Optionally solder (1 to 4) JST XH 2-pin sockets  (J1 - J4)
      2. Optionally solder RJ45 sockets (J5)
>  See also: [Soldering Tips](/pcb-soldering/)

## Testing and Verification

The following test and verifications of the card should be performed after a through inspection of the card's soldering.  Check all of the PTH component pins and SMD pads.  Make sure there are no solder bridges between pins and pads.

### Visual Inspection

1. **Initial Check**: Examine the board for any obvious issues like missing components, solder bridges, or components that are misaligned or not fully seated.

2. **Solder Joint Inspection**: Use a magnifying glass or a microscope to inspect solder joints. Look for cold solder joints, insufficient or excessive solder, or any shorts between pads.

3. **Component Orientation**: the IC's are correctly oriented according to the PCB silkscreen or schematic.

### Connectivity Testing

1. **Continuity Check**: Use a multimeter in continuity mode to check for shorts between power rails and ground, and to ensure there are no open circuits in critical connections.

### Power-Up Tests

1. Assembly a tested Power Module to the [Node Card](/node-card-assembly-guide/).
2. Apply Power to the Power Module and verify the following:
   - **Check for Hot Components**: Feel for components that are overheating, which could indicate a problem like a short circuit or incorrect component.

### Functional Testing

#### I2C Verification

1. Verify that the I2C connection between the  [Node Card](/node-card-assembly-guide/) and the [Audio Card](/audio-card-assembly-guide/) work.  See [Testing I2C Cards](@ref testing_I2C_cards) for details on how to test the I2C for a I2C enabled card.


## Troubleshooting

- See [I2C Trouble Shooting](/test-i2c-cards/).

## References

1.  [Choosing the Right Resistor for LEDs](/led-card-usage-guide/).

